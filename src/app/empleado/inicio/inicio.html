<!-- ğŸŒ¸ ALERTA PASTEL -->
<div *ngIf="alerta.mostrar"
     [ngClass]="{
       'alert-success': alerta.tipo === 'success',
       'alert-error': alerta.tipo === 'error',
       'alert-warning': alerta.tipo === 'warning'
     }"
     class="alerta-pastel">
  {{ alerta.mensaje }}
</div>

<div class="dashboard-container">

  <header class="header">
    <h1>ğŸ‚ PastelerÃ­a Dulce Arte</h1>
    <div class="header-actions">
      <button class="btn add" (click)="abrirModalAgregar()">â• Agregar Pedido Especial</button>
      <button class="btn view" (click)="abrirModalPedidos()">ğŸ“‹ Ver Pedidos</button>
    </div>
  </header>

  <section class="stats-section">

    <div class="card">
      <h2>Ingresos Hoy</h2>
      <div *ngIf="loadingStats" class="spinner-border text-primary spinner-border-sm" role="status"></div>
      <p *ngIf="!loadingStats" class="value">${{ ingresosHoy | number:'1.2-2' }}</p>
      <span class="tag success">Dinero en caja</span>
    </div>

    <div class="card">
      <h2>Ventas Hoy</h2>
      <div *ngIf="loadingStats" class="spinner-border text-primary spinner-border-sm" role="status"></div>
      <p *ngIf="!loadingStats" class="value">{{ ventasHoy }}</p>
      <span class="tag info">Transacciones</span>
    </div>

    <div class="card">
      <h2>Pedidos Pendientes</h2>
      <div *ngIf="loadingPedidos && pedidosPendientes.length === 0" class="spinner-border text-warning spinner-border-sm"
        role="status"></div>
      <p *ngIf="!loadingPedidos" class="value">{{ pedidosPendientes.length }}</p>
      <span class="tag warning">Por entregar</span>
    </div>

    <div class="card">
      <h2>Pedidos Entregados</h2>
      <div *ngIf="loadingPedidos" class="spinner-border text-success spinner-border-sm" role="status"></div>
      <p *ngIf="!loadingPedidos" class="value">{{ pedidosEntregados.length }}</p>
      <span class="tag success">Completados</span>
    </div>

  </section>

  <section class="news-section">
    <h2>ğŸ§ Novedades y Lanzamientos</h2>

    <div class="news-container">
      <div class="news-card">
        <img src="https://www.suqiee.com.mx/wp-content/uploads/2022/12/instagram-pastel-de-chocolate-1.jpg"
          class="news-img-local" />
        <div class="news-info">
          <h3>ğŸ« Nuevo Pastel de Chocolate</h3>
          <p>Hecho con cacao 100% natural y ganache artesanal.</p>
        </div>
      </div>

      <div class="news-card">
        <img src="https://aranzazu.com/wp-content/uploads/2025/08/pastel-Labubu.webp" alt="Pasteles personalizados" />
        <div class="news-info">
          <h3>ğŸ¨ Pasteles TemÃ¡ticos</h3>
          <p>Elige tu diseÃ±o favorito o envÃ­anos tu idea.</p>
        </div>
      </div>

      <div class="news-card">
        <img src="https://static.promodescuentos.com/threads/raw/NrXHZ/795892_1/re/1024x1024/qt/60/795892_1.jpg"
          alt="Ofertas" />
        <div class="news-info">
          <h3>Ofertas en Tienda</h3>
          <p>Descuentos en pasteles de existencia seleccionados.</p>
        </div>
      </div>
    </div>

    <div class="news-container mt-4">
      <div class="news-card">
        <img src="https://pasteleriacaty.com/wp-content/uploads/2019/12/San-Nicolas.jpg"
          alt="Nueva sucursal en Puebla" />
        <div class="news-info">
          <h3>ğŸ‰ Nueva Sucursal en Puebla</h3>
          <p>VisÃ­tanos en Av. Reforma #321. Promociones de apertura durante todo el mes de noviembre.</p>
        </div>
      </div>

      <div class="news-card">
        <img src="https://i.ytimg.com/vi/Rxt-pxSZUk4/sddefault.jpg" alt="Pasteles personalizados" />
        <div class="news-info">
          <h3>Eventos exclusivos</h3>
          <p>Concurso o evento donde se muestra a nuestros mejores pasteleros haciendo gala de su creatividad.</p>
        </div>
      </div>

      <div class="news-card">
        <img src="https://images.milenio.com/GwM4IUah3p1rrWmQT9Gz898H5vA=/345x194/uploads/media/2024/02/18/repostera-viral-pastel-forma-copa.jpg"
          alt="Pasteles personalizados" />
        <div class="news-info">
          <h3>Pasteles Exclusivos</h3>
          <p>Pasteles hechos con la mejor creatividad de la industria y colaboraciones Ãºnicas.</p>
        </div>
      </div>
    </div>

  </section>

  <!-- MODAL AGREGAR -->
  <div class="modal" *ngIf="mostrarAgregar">
    <div class="modal-content pedido-card">
      <h2>ğŸ° Agregar Pedido</h2>

      <form (ngSubmit)="guardarPedido()" class="pedido-form">

        <div class="form-step">
          <label>Tipo de producto:</label>
          <select [(ngModel)]="nuevoPedido.Tipo" name="Tipo" required>
            <option value="">Selecciona un tipo</option>
            <option *ngFor="let t of tiposProductos" [value]="t">{{ t }}</option>
          </select>
        </div>

        <div *ngIf="nuevoPedido.Tipo">
          <div class="form-step"><label>Nombre Cliente:</label>
            <input type="text" [(ngModel)]="nuevoPedido.nombre" name="nombre" required />
          </div>

          <div class="form-step"><label>TelÃ©fono:</label>
            <input type="tel" [(ngModel)]="nuevoPedido.telefono" name="telefono" required />
          </div>

          <div class="form-step"><label>Lugar de Entrega:</label>
            <input type="text" [(ngModel)]="nuevoPedido.lugar" name="lugar" placeholder="Sucursal o Domicilio" />
          </div>

          <div class="form-step"><label>Fecha de entrega:</label>
            <input type="date" [(ngModel)]="nuevoPedido.fecha" name="fecha" required />
          </div>
        </div>

        <div *ngIf="nuevoPedido.Tipo === 'Pastel'">
          <div class="form-step"><label>Kilos:</label><input type="number" [(ngModel)]="nuevoPedido.kilos" name="kilos"></div>
          <div class="form-step"><label>Relleno:</label><input type="text" [(ngModel)]="nuevoPedido.relleno" name="relleno"></div>
          <div class="form-step"><label>TemÃ¡tica:</label><input type="text" [(ngModel)]="nuevoPedido.tematica" name="tematica"></div>
        </div>

        <div *ngIf="nuevoPedido.Tipo === 'Bebida' || nuevoPedido.Tipo === 'Galletas' || nuevoPedido.Tipo === 'Postre'">
          <div class="form-step"><label>Sabor:</label><input type="text" [(ngModel)]="nuevoPedido.sabor" name="sabor"></div>
          <div class="form-step"><label>Cantidad:</label><input type="number" [(ngModel)]="nuevoPedido.cantidad" name="cantidad"></div>
        </div>

        <div class="modal-actions">
          <button type="submit" class="btn save">ğŸ’¾ Guardar</button>
          <button type="button" class="btn cancel" (click)="cerrarModal()">âŒ Cancelar</button>
        </div>

      </form>
    </div>
  </div>

  <!-- MODAL PEDIDOS -->
  <div class="modal" *ngIf="mostrarPedidos">
    <div class="modal-content">
      <h2 class="titulo-seccion">Pedidos Pendientes</h2>

      <div class="cuadro-pendientes">

        <div *ngFor="let pedido of pedidosPendientes" class="fila-pedido">

          <!-- INFORMACIÃ“N (IZQUIERDA) -->
          <div class="info-pedido">
            <p class="tipo-nombre">ğŸ° <strong>{{ pedido.Tipo }} - {{ pedido.nombre }}</strong></p>
            <p class="detalle">{{ pedido.tematica || pedido.sabor || pedido.color }}</p>

            <p class="info">
              ğŸ“ {{ pedido.telefono }}
              â€”  
              ğŸ“… {{ pedido.fecha | date:'shortDate' }}
            </p>
          </div>

          <!-- ACCIONES EN VERTICAL (DERECHA) -->
          <div class="acciones-vertical">
            <select class="estado-mini"
            [(ngModel)]="pedido.estado"
            (change)="cambiarEstadoPedido(pedido)">
              <option value="pendiente">En proceso</option>
              <option value="listo">Listo</option>
              <option value="entregado">Entregado</option>
            </select>
            

            <button class="btn-eye" (click)="verReporte(pedido)">ğŸ‘ï¸ Ver</button>
            <button class="btn-cancel" (click)="cancelarPedido(pedido)">âœ– Cancelar</button>
          </div>
        </div>
      </div>
            

      <h3 class="mt-3 titulo-desplegable" (click)="toggleListos()">
        Pedidos Listos para Entregar
        <span class="flecha" [class.abierto]="mostrarListos">â–¼</span>
      </h3>
      
      <ul class="lista-listos" *ngIf="mostrarListos">
        <li *ngFor="let p of pedidosListos" class="listo-item">
      
          <div class="listo-info">
            â³ {{ p.Tipo }} - {{ p.nombre }}
            <span class="fecha">({{ p.fecha | date:'shortDate' }})</span>
          </div>
      
          <button class="btn-entregar" (click)="entregarPedido(p)">
            âœ” Entregar
          </button>
      
          <button class="btn-cancelarpedido" (click)="cancelarPedido(p)">
            âœ– Cancelar
          </button>
      
        </li>
      </ul>
      
          <!-- LISTA DESPLEGABLE DE PEDIDOS ENTREGADOS -->
          <h3 class="mt-3 titulo-desplegable" (click)="toggleEntregados()">
            Pedidos Entregados 
            <span class="flecha" [class.abierto]="mostrarEntregados">â–¼</span>
          </h3>

          <ul class="lista-entregados" *ngIf="mostrarEntregados">
            <li *ngFor="let p of pedidosEntregados" class="entregado-item">
              
              <div class="entregado-info">
                âœ”ï¸ {{ p.Tipo }} - {{ p.nombre }} 
                <span class="fecha">({{ p.fecha | date:'shortDate' }})</span>
              </div>

              <button class="btn-reporte" (click)="verReporte(p)">
                ğŸ§¾ Reporte
              </button>

            </li>
          </ul>

      <div class="modal-actions">
        <button class="btn cancel" (click)="cerrarModal()">Cerrar</button>
      </div>
    </div>
  </div>

  

  <!-- MODAL REPORTE -->
  <div class="modal" *ngIf="reporteSeleccionado">
    <div class="modal-content">
      <h2>Detalle del Pedido</h2>

      <div class="reporte-info">
        <p><strong>Tipo:</strong> {{ reporteSeleccionado.Tipo }}</p>
        <p><strong>Cliente:</strong> {{ reporteSeleccionado.nombre }}</p>
        <p><strong>TelÃ©fono:</strong> {{ reporteSeleccionado.telefono }}</p>
        <p><strong>Entrega:</strong> {{ reporteSeleccionado.fecha | date:'fullDate' }}</p>
        <p><strong>Lugar:</strong> {{ reporteSeleccionado.lugar }}</p>
        <hr>

        <div *ngIf="reporteSeleccionado.Tipo === 'Pastel'">
          <p><strong>Kilos:</strong> {{ reporteSeleccionado.kilos }}</p>
          <p><strong>Relleno:</strong> {{ reporteSeleccionado.relleno }}</p>
          <p><strong>TemÃ¡tica:</strong> {{ reporteSeleccionado.tematica }}</p>
          <p><strong>Color:</strong> {{ reporteSeleccionado.color }}</p>
        </div>

        <div *ngIf="reporteSeleccionado.Tipo !== 'Pastel'">
          <p><strong>Sabor:</strong> {{ reporteSeleccionado.sabor }}</p>
          <p><strong>Cantidad:</strong> {{ reporteSeleccionado.cantidad }}</p>
          <p><strong>TamaÃ±o:</strong> {{ reporteSeleccionado.tamano }}</p>
        </div>
      </div>

      <button class="cerrar" (click)="cerrarReporte()">Cerrar</button>
      <button class="descargar" (click)="descargarPDF()">Descargar PDF</button>
    </div>
  </div>

</div>
