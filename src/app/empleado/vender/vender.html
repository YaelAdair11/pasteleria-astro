<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Pasteler√≠a Angular - Sistema de Cobro</title>
  <link rel="stylesheet" href="vender.css">
</head>
<body>
  <div class="panel">
    <header>
      <h1>üéÇ Pasteler√≠a Angular</h1>
      <span>Cajero: Jonathan Su√°rez | Caja #1</span>
    </header>

    <div class="scanner">
      <input id="codigo" type="text" placeholder="Escanea o ingresa el c√≥digo del producto...">
      <button id="btnAgregar">Agregar</button>
    </div>

    <table id="tabla">
      <thead>
        <tr>
          <th>C√≥digo</th>
          <th>Producto</th>
          <th>Precio</th>
          <th>Cantidad</th>
          <th>Subtotal</th>
          <th></th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="totales">
      Total: $<span id="total">0.00</span>
    </div>

    <div class="acciones">
      <button class="btn secundario" id="btnCancelar">Cancelar venta</button>
      <button class="btn primario" id="btnCobrar">Cobrar</button>
    </div>

    <!-- Ticket -->
    <div id="ticket" class="ticket" style="display:none;">
      <h3>üéÇ Pasteler√≠a Angular</h3>
      <p><strong>Gracias por su compra</strong></p>
      <table id="ticketTabla"></table>
      <p><strong>Total: $<span id="ticketTotal"></span></strong></p>
      <div class="acciones-ticket">
        <button class="btn primario" id="btnImprimir">üñ®Ô∏è Imprimir / Guardar PDF</button>
      </div>
      <p><strong>¬°Vuelva pronto!</strong></p>
    </div>
  </div>

  <script>
    const productos = [
      { codigo: '1001', nombre: 'Pastel de tres leches', precio: 150.00 },
      { codigo: '1002', nombre: 'Pastel de chocolate', precio: 180.00 },
      { codigo: '1003', nombre: 'Pastel de avellana', precio: 120.00 },
      { codigo: '1004', nombre: 'Pastel de queso Philadelphia', precio: 240.00 },
      { codigo: '1005', nombre: 'Pastel de durazno', precio: 170.00 },
    ];

    // ‚úÖ Carrito precargado con dos productos
    let carrito = [
      { codigo: '1001', nombre: 'Pastel de tres leches', precio: 150.00, cantidad: 1 },
      { codigo: '1002', nombre: 'Pastel de chocolate', precio: 180.00, cantidad: 2 },
    ];

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('btnAgregar').addEventListener('click', agregarPorCodigo);
      document.getElementById('btnCobrar').addEventListener('click', cobrar);
      document.getElementById('btnCancelar').addEventListener('click', limpiar);
      document.getElementById('codigo').addEventListener('keypress', e => {
        if (e.key === 'Enter') agregarPorCodigo();
      });

      document.getElementById('btnImprimir').addEventListener('click', imprimirTicket);

      // üëá Mostrar productos precargados al iniciar
      renderTabla();
    });

    function agregarPorCodigo() {
      const codigo = document.getElementById('codigo').value.trim();
      const producto = productos.find(p => p.codigo === codigo);

      if (!producto) {
        alert('C√≥digo no encontrado');
        document.getElementById('codigo').value = '';
        return;
      }

      const existente = carrito.find(p => p.codigo === codigo);
      if (existente) {
        existente.cantidad++;
      } else {
        carrito.push({ ...producto, cantidad: 1 });
      }

      document.getElementById('codigo').value = '';
      renderTabla();
    }

    function renderTabla() {
      const tbody = document.querySelector('#tabla tbody');
      tbody.innerHTML = '';

      carrito.forEach((p, i) => {
        const subtotal = (p.precio * p.cantidad).toFixed(2);
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${p.codigo}</td>
          <td>${p.nombre}</td>
          <td>$${p.precio.toFixed(2)}</td>
          <td><input type='number' min='1' value='${p.cantidad}' onchange='cambiarCantidad(${i}, this.value)'></td>
          <td>$${subtotal}</td>
          <td><button class="borrar" onclick='eliminar(${i})'>üóëÔ∏è</button></td>
        `;
        tbody.appendChild(tr);
      });

      actualizarTotal();
    }

    function cambiarCantidad(i, val) {
      const cantidad = parseInt(val);
      if (cantidad > 0) {
        carrito[i].cantidad = cantidad;
        renderTabla();
      }
    }

    function eliminar(i) {
      carrito.splice(i, 1);
      renderTabla();
    }

    function actualizarTotal() {
      const total = carrito.reduce((sum, p) => sum + p.precio * p.cantidad, 0);
      document.getElementById('total').textContent = total.toFixed(2);
    }

    function cobrar() {
      if (carrito.length === 0) {
        alert('No hay productos en el carrito');
        return;
      }

      const total = parseFloat(document.getElementById('total').textContent);
      alert(`Cobro exitoso. Total: $${total.toFixed(2)}`);

      mostrarTicket(total);
    }

    function mostrarTicket(total) {
      const ticket = document.getElementById('ticket');
      const tabla = document.getElementById('ticketTabla');
      tabla.innerHTML = '';

      carrito.forEach(p => {
        const fila = document.createElement('tr');
        fila.innerHTML = `<td>${p.nombre}</td><td>x${p.cantidad}</td><td>$${(p.precio * p.cantidad).toFixed(2)}</td>`;
        tabla.appendChild(fila);
      });

      document.getElementById('ticketTotal').textContent = total.toFixed(2);
      ticket.style.display = 'block';
    }

    function imprimirTicket() {
      const ticket = document.getElementById('ticket');
      const ventana = window.open('', 'PRINT', 'height=600,width=400');
      ventana.document.write(`
        <html>
          <head>
            <title>Ticket - Pasteler√≠a Angular</title>
            <style>
              body { font-family: Arial; text-align:center; }
              table { width:100%; border-collapse: collapse; margin-top: 10px;}
              td, th { padding: 5px; border-bottom: 1px solid #ccc; }
            </style>
          </head>
          <body>${ticket.innerHTML}</body>
        </html>
      `);
      ventana.document.close();
      ventana.focus();
      ventana.print();
      ventana.close();
    }

    function limpiar() {
      if (confirm('¬øCancelar venta actual?')) {
        carrito = [];
        renderTabla();
        document.getElementById('ticket').style.display = 'none';
      }
    }
  </script>
</body>
</html>
